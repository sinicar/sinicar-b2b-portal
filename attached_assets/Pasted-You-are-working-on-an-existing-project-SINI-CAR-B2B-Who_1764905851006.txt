You are working on an existing project:

SINI CAR – B2B Wholesale Customer Portal
(React + Vite + TypeScript + Tailwind + mockApi + LocalStorage + i18n AR/EN/HI/ZH)

Your task is to add a new fully-configurable feature:

“Installment Wholesale Purchase Request System”
(Customers can request goods on credit/instalments, SINI CAR has first priority to accept or reject, and then requests can optionally be forwarded to external suppliers. All logic must be driven by settings, not hard-coded.)

GLOBAL RULES (VERY IMPORTANT):

Read the entire existing codebase and structure first (pages, components, models, mockApi, context, hooks, Supplier Marketplace, Admin, Customer Portal).

Do NOT delete, rewrite, or break any existing logic or UI.

Follow the existing coding style (React + TypeScript + Tailwind via CDN + mockApi + LocalStorage + i18n).

Everything in this feature must be configurable from Admin settings at a very detailed level to minimize future code changes.

No external backend. All data must live in mockApi + LocalStorage.

Do not change current behavior of products, orders, tools, suppliers, affiliates, etc. Only extend the system with this new feature and integrate with existing roles (Customer / Admin / Supplier).

The feature has three main parts:

Data models and mockApi functions (including settings).

Customer-side UI to submit and manage installment requests and offers.

Admin and Supplier UIs to review, approve (full or partial), forward to suppliers, and manage instalment contracts.

PART 1 — DATA MODELS AND SETTINGS

Create appropriate TypeScript models in a file such as:
src/models/installments.ts
(or integrate in the existing models folder, matching the project’s organization).

InstallmentRequest
Represents the main request submitted by a customer.

Fields (you can adjust naming to fit project style, but keep the logic):

export interface InstallmentRequest {
id: string;
customerId: string;

// Requested items or total value:
items: InstallmentRequestItem[]; // can be empty if using only totalValue
totalRequestedValue?: number; // optional total requested amount

// Customer proposal for payment:
requestedDurationMonths?: number; // e.g., 3, 6, 12
requestedDurationWeeks?: number; // alternative if weekly
paymentFrequency: 'weekly' | 'monthly';
proposedInstallmentAmount?: number; // amount per period
downPaymentAmount?: number; // optional initial payment

notes?: string; // customer notes

// Workflow status:
status: InstallmentRequestStatus;

// SINI CAR decision summary:
sinicarDecision: 'pending' | 'approved_full' | 'approved_partial' | 'rejected';
allowedForSuppliers: boolean; // true if request can be forwarded to suppliers after SINI CAR decision

// Reference to final accepted offer:
acceptedOfferId?: string;

createdAt: string;
updatedAt: string;
}

Define an enum-like type for status, for example:

export type InstallmentRequestStatus =
| 'PENDING_SINICAR_REVIEW'
| 'WAITING_FOR_CUSTOMER_DECISION_ON_PARTIAL_SINICAR'
| 'REJECTED_BY_SINICAR'
| 'FORWARDED_TO_SUPPLIERS'
| 'WAITING_FOR_SUPPLIER_OFFERS'
| 'WAITING_FOR_CUSTOMER_DECISION_ON_SUPPLIER_OFFER'
| 'ACTIVE_CONTRACT'
| 'CLOSED'
| 'CANCELLED';

InstallmentRequestItem
Represents each product/line in the request.

export interface InstallmentRequestItem {
id: string;
requestId: string;
productId?: string; // optional if not linked to internal product yet
description?: string;
quantityRequested: number;
unitPriceRequested?: number;
}

InstallmentOffer
Each decision (full or partial approval) from SINI CAR or from a Supplier is stored as an offer.

export interface InstallmentOffer {
id: string;
requestId: string;

sourceType: 'sinicar' | 'supplier';
supplierId?: string; // required if sourceType = 'supplier'

type: 'full' | 'partial'; // full approval or partial approval

// What exactly is being approved:
itemsApproved: InstallmentOfferItem[]; // subset or modified items
totalApprovedValue: number;

// Final payment plan for this offer:
schedule: InstallmentPaymentSchedule;

// Offer lifecycle:
status: InstallmentOfferStatus; // waiting_for_customer, accepted_by_customer, rejected_by_customer

createdAt: string;
updatedAt: string;
}

export type InstallmentOfferStatus =
| 'WAITING_FOR_CUSTOMER'
| 'ACCEPTED_BY_CUSTOMER'
| 'REJECTED_BY_CUSTOMER';

InstallmentOfferItem
Represents each approved line inside an offer.

export interface InstallmentOfferItem {
id: string;
offerId: string;
requestItemId?: string;
productId?: string;
quantityApproved: number;
unitPriceApproved: number;
}

InstallmentPaymentSchedule
Represents the payment plan for an accepted offer.

export interface InstallmentPaymentSchedule {
frequency: 'weekly' | 'monthly';
numberOfInstallments: number;
installmentAmount: number;
startDate: string;
endDate: string;
installments: InstallmentPaymentInstallment[];
}

export interface InstallmentPaymentInstallment {
id: string;
dueDate: string;
amount: number;
status: 'pending' | 'paid' | 'overdue';
paidAt?: string;
}

CustomerCreditProfile (optional but recommended)
Used to show basic credit score and history.

export interface CustomerCreditProfile {
customerId: string;
scoreLevel: 'low' | 'medium' | 'high'; // risk or strength
totalInstallmentRequests: number;
totalActiveContracts: number;
totalOverdueInstallments: number;
lastUpdated: string;
}

InstallmentSettings
This is critical: all behavior must be controlled by settings, not hard-coded.

export interface InstallmentSettings {
enabled: boolean;

// SINI CAR priority behavior:
sinicarHasFirstPriority: boolean; // always true, but keep as setting
allowPartialApprovalBySinicar: boolean;
allowPartialApprovalBySuppliers: boolean;

// What happens when SINI CAR rejects:
autoForwardToSuppliersOnSinicarReject: boolean;
autoForwardToSuppliersOnSinicarPartialRemainder: boolean; // remaining part of the request

// Customer decisions:
onCustomerRejectsSinicarPartial: 'close_request' | 'forward_to_suppliers';
onCustomerRejectsSupplierOffer: 'keep_waiting_for_other_suppliers' | 'close_request';

// Limits and thresholds:
maxDurationMonths: number;
minDurationMonths: number;
requireDownPayment: boolean;
minDownPaymentPercent?: number;

// Notifications/UX (for future use, but add flags now):
notifyCustomerOnNewOffer: boolean;
notifyAdminOnNewRequest: boolean;
notifySuppliersOnForward: boolean;
}

Store these settings in LocalStorage and make them editable from Admin UI, not hard-coded.

PART 2 — mockApi AND LOCALSTORAGE INTEGRATION

Create or extend mockApi functions for all new entities.

Use LocalStorage keys like:

"installmentRequests"

"installmentOffers"

"customerCreditProfiles"

"installmentSettings"

Implement CRUD-style functions (TypeScript) such as:

Installment Requests:

getInstallmentRequests()

getInstallmentRequestById(id)

createInstallmentRequest(payload)

updateInstallmentRequest(id, partialData)

Installment Offers:

getOffersByRequestId(requestId)

createInstallmentOffer(payload)

updateInstallmentOffer(id, partialData)

Credit Profiles:

getCustomerCreditProfile(customerId)

upsertCustomerCreditProfile(profile)

Settings:

getInstallmentSettings()

updateInstallmentSettings(partialSettings)

Business helper functions (high-level):

createNewInstallmentRequestFromCustomer(customerId, payload)

Validates against InstallmentSettings (feature enabled, max/min duration, etc).

Creates InstallmentRequest with status = 'PENDING_SINICAR_REVIEW'.

Sets sinicarDecision = 'pending', allowedForSuppliers = false.

Triggers any admin notifications if enabled in settings.

recordSinicarDecision(requestId, decisionPayload)
where decisionPayload includes:

decisionType: 'approve_full' | 'approve_partial' | 'reject'

offer details if approve_full/partial

whether forwarding to suppliers is allowed for remainder or after reject, depending on settings.

This function must:

Update InstallmentRequest.sinicarDecision.

Generate an InstallmentOffer when approving (full or partial).

Set status:

'APPROVED_BY_SINICAR_FULL' → and then 'ACTIVE_CONTRACT' after customer auto-accept or manual accept (depending on your logic).

'WAITING_FOR_CUSTOMER_DECISION_ON_PARTIAL_SINICAR' if partial and customer must confirm.

'REJECTED_BY_SINICAR' and maybe 'FORWARDED_TO_SUPPLIERS' depending on settings.

forwardRequestToSuppliers(requestId, supplierIds)

Only allowed when:
sinicarDecision = 'rejected' OR sinicarDecision = 'approved_partial' for the remaining part.

You must respect InstallmentSettings (auto or manual forwarding).

Sets status to 'FORWARDED_TO_SUPPLIERS' or 'WAITING_FOR_SUPPLIER_OFFERS'.

supplierSubmitOffer(requestId, supplierId, offerPayload)

Creates a new InstallmentOffer with sourceType = 'supplier'.

Offer type can be 'full' or 'partial', based on what the supplier can provide.

Sets InstallmentOffer.status = 'WAITING_FOR_CUSTOMER'.

Updates InstallmentRequest.status to 'WAITING_FOR_CUSTOMER_DECISION_ON_SUPPLIER_OFFER'.

customerRespondToOffer(offerId, decision)

decision: 'accept' or 'reject'.

If accept:

Mark offer.status = 'ACCEPTED_BY_CUSTOMER'.

Update InstallmentRequest.status = 'ACTIVE_CONTRACT'.

Set InstallmentRequest.acceptedOfferId = offerId.

Generate payment schedule installments if not already generated.

Update CustomerCreditProfile.

If reject:

Mark offer.status = 'REJECTED_BY_CUSTOMER'.

Depending on InstallmentSettings:

onCustomerRejectsSinicarPartial

onCustomerRejectsSupplierOffer
Update InstallmentRequest.status accordingly (close or keep waiting for other offers).

generatePaymentSchedule(offer)

Use offer schedule info (frequency, numberOfInstallments, etc).

Create InstallmentPaymentSchedule with installments: each with dueDate and amount.

This function must be deterministic and follow settings (for example, always start schedule after approval date).

All these functions must use the same patterns and helpers already used in the existing mockApi (for IDs, timestamps, LocalStorage access, error handling).

PART 3 — CUSTOMER UI (PORTAL SIDE)

Add a new section/page in the Customer Portal, for example route:

/customer/installment-requests

This page should support:

A form to create a new Installment Request.

A list of previous requests and their statuses.

A view to see offers and respond (accept/reject) to partial or supplier offers.

New Installment Request Form:

Accessible only if InstallmentSettings.enabled is true.

Fields:

Select products and quantities OR enter a total requested amount.

Choose paymentFrequency: weekly or monthly.

Choose requested duration (respect min/max from settings).

Optional: proposed installment amount.

Optional: downPaymentAmount (if requireDownPayment is true, enforce minDownPaymentPercent).

Notes.

On submit:

Call createNewInstallmentRequestFromCustomer.

Show confirmation and add request to list.

Installment Requests List:

Show each request:

Created date.

Status (translated depending on i18n).

Total requested value.

Current decision stage:

Pending SINI CAR

Waiting on your decision for partial offer

Waiting on supplier offers

Active contract

Closed/Cancelled

Allow clicking to view details.

Offer & Contract Detail View:
When customer opens a specific request:

If there is a pending partial offer (from SINI CAR or from suppliers) with status = WAITING_FOR_CUSTOMER:

Show offer details:

Who (SINI CAR or Supplier X).

Full or partial.

Approved items and values.

Payment schedule summary (number of installments, amount, dates).

Buttons:

Accept offer.

Reject offer.

These actions call customerRespondToOffer.

If there is an active contract:

Show payment schedule (installments list with status pending/paid/overdue).

Show summary of how much is paid and how much remains.

Respect i18n and RTL for Arabic.

PART 4 — ADMIN UI (INSTALLMENT MANAGEMENT)

Add a new Admin page, for example route:

/admin/installments

Add a menu item in Admin sidebar:

Label: “Installment Requests”

Inside this Admin page, create tabs (using the existing Tabs UI components):

New / Pending (PENDING_SINICAR_REVIEW)

Customer Decisions (WAITING_FOR_CUSTOMER_DECISION_ON_PARTIAL_SINICAR and WAITING_FOR_CUSTOMER_DECISION_ON_SUPPLIER_OFFER)

Forwarded to Suppliers (FORWARDED_TO_SUPPLIERS / WAITING_FOR_SUPPLIER_OFFERS)

Active Contracts (ACTIVE_CONTRACT)

Settings

Credit Profiles (optional simple view)

New / Pending Tab:

Table of all requests with status = PENDING_SINICAR_REVIEW.

Columns:

Customer

Request value

Payment frequency

Requested duration

Created at

Actions: “Review”

On “Review”, open detail view:

Show requested items and summary.

Show customer credit profile (if available).

Admin can choose one of:

a) Approve Full (SINI CAR):

Create full InstallmentOffer (sourceType = sinicar, type = full).

Fill final payment schedule (could be auto-calculated based on settings).

Update request: sinicarDecision = approved_full, status = ACTIVE_CONTRACT or WAITING_FOR_CUSTOMER if you require explicit acceptance.

b) Approve Partial (SINI CAR):

Select subset of items or adjust quantities/values.

Create partial InstallmentOffer (type = partial).

Update request: sinicarDecision = approved_partial, status = WAITING_FOR_CUSTOMER_DECISION_ON_PARTIAL_SINICAR.

c) Reject (by SINI CAR):

Set sinicarDecision = rejected.

Depending on settings:

autoForwardToSuppliersOnSinicarReject:

If true: forward to suppliers (set status = FORWARDED_TO_SUPPLIERS or WAITING_FOR_SUPPLIER_OFFERS).

If false: set status = REJECTED_BY_SINICAR (no forwarding).

Customer Decisions Tab:

List requests where the customer still needs to decide on an offer:

WAITING_FOR_CUSTOMER_DECISION_ON_PARTIAL_SINICAR

WAITING_FOR_CUSTOMER_DECISION_ON_SUPPLIER_OFFER

Show:

Customer

Source of offer (SINI CAR or supplier name)

Offer summary

Status

Not much admin action here except “view only” and maybe override (optional, but keep it simple).

Forwarded to Suppliers Tab:

Shows requests that have been forwarded to suppliers and are waiting for offers:

FORWARDED_TO_SUPPLIERS

WAITING_FOR_SUPPLIER_OFFERS

Admin can:

See which suppliers the request has been sent to.

See incoming supplier offers.

Optionally force-close the request.

Active Contracts Tab:

List of requests with status = ACTIVE_CONTRACT.

Show:

Customer

Source of final offer (SINI CAR or supplier)

Total contract value

Remaining balance

Number of overdue installments (if any)

Allow admin to mark installments as paid (if not already integrated with payment system).

Basic filtering (by customer, supplier, overdue yes/no).

Settings Tab:
This is critical to satisfy the requirement “everything is settings to minimize future code changes”.

Create an Admin settings form bound to InstallmentSettings:

Fields:

enabled (toggle)

sinicarHasFirstPriority (always true, but still a setting)

allowPartialApprovalBySinicar (toggle)

allowPartialApprovalBySuppliers (toggle)

autoForwardToSuppliersOnSinicarReject (toggle)

autoForwardToSuppliersOnSinicarPartialRemainder (toggle)

onCustomerRejectsSinicarPartial (dropdown: close_request / forward_to_suppliers)

onCustomerRejectsSupplierOffer (dropdown: keep_waiting_for_other_suppliers / close_request)

maxDurationMonths (number)

minDurationMonths (number)

requireDownPayment (toggle)

minDownPaymentPercent (number if required)

notifyCustomerOnNewOffer (toggle)

notifyAdminOnNewRequest (toggle)

notifySuppliersOnForward (toggle)

Bind this form to getInstallmentSettings() and updateInstallmentSettings() in mockApi.

Credit Profiles Tab (optional basic view):

List of customers with their credit profiles:

customer name

scoreLevel

totalInstallmentRequests

totalActiveContracts

totalOverdueInstallments

Simple read-only for version 1.

PART 5 — SUPPLIER UI INTEGRATION

If there is a Supplier Portal or Supplier Marketplace area, add a new page for suppliers:

Route example:
/supplier/installment-requests

This page shows all installment requests that were forwarded to this supplier and are not yet resolved.

For each request:

Display customer (or anonymized if needed).

Requested items/value.

Requested payment plan.

Supplier actions:

Create Offer:

Can be full or partial (controlled by InstallmentSettings.allowPartialApprovalBySuppliers).

Choose which items they can supply, quantities, prices.

Define payment schedule (frequency, duration, installment amount).

Submit offer → creates InstallmentOffer with sourceType = 'supplier' and status = WAITING_FOR_CUSTOMER.

No supplier should ever see a request before SINI CAR has made a decision. Respect sinicarHasFirstPriority and the allowedForSuppliers flag in InstallmentRequest.

PART 6 — PERMISSIONS AND i18n

Permissions:
Add permission keys (if your system uses them):

canViewInstallmentRequests

canManageInstallmentRequests

canManageInstallmentSettings

Use these to show or hide Admin menu items, tabs, and actions.

i18n:
For every label, button, column header, status text, and error message:

Add translation keys in the existing i18n system (AR/EN at minimum).

Do not hardcode strings in components.

FINAL NOTES

Keep all logic inside the existing architecture: React + TypeScript + mockApi + LocalStorage.

Do not break existing flows for products, orders, tools, suppliers, etc.

Make sure every behavioral choice (partial approval, forwarding, closing, etc.) is controlled by InstallmentSettings, not hard-coded.

Use the existing UI patterns (cards, tables, tabs, forms) and Tailwind classes already used throughout the project.

Read this specification completely before coding and implement it step-by-step, keeping the code clean, typed, and consistent with the rest of the SINI CAR project.

END OF SPECIFICATION.