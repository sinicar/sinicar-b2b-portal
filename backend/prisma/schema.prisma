generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============ Enums ============

enum SupplierType {
  LOCAL
  INTERNATIONAL
}

enum UploadStatus {
  PENDING_REVIEW
  APPROVED
  REJECTED
  NEEDS_CORRECTION
}

// ============ User & Auth Models ============

model User {
  id                   String    @id @default(uuid())
  clientId             String    @unique
  name                 String
  email                String?
  phone                String?
  password             String?
  role                 String    @default("CUSTOMER_OWNER")
  employeeRole         String?
  status               String    @default("PENDING")
  isActive             Boolean   @default(true)
  parentId             String?
  businessId           String?
  activationCode       String?
  passwordResetToken   String?
  passwordResetExpiry  DateTime?
  searchLimit          Int       @default(100)
  searchUsed           Int       @default(0)
  failedLoginAttempts  Int       @default(0)
  lastLoginAt          DateTime?
  lastActiveAt         DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  
  isCustomer           Boolean   @default(true)
  isSupplier           Boolean   @default(false)
  completionPercent    Int       @default(0)
  whatsapp             String?
  clientCode           String?
  
  preferredCurrency    String?
  preferredLanguage    String    @default("ar")

  parent               User?     @relation("UserHierarchy", fields: [parentId], references: [id])
  children             User[]    @relation("UserHierarchy")
  profile              BusinessProfile?
  organizationUsers    OrganizationUser[]
  orders               Order[]
  quoteRequests        QuoteRequest[]
  installmentRequests  InstallmentRequest[]
  activityLogs         ActivityLog[]
  roleAssignments      UserRoleAssignment[]
}

model BusinessProfile {
  id                    String    @id @default(uuid())
  userId                String    @unique
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  companyName           String?
  phone                 String?
  region                String?
  city                  String?
  crNumber              String?
  taxNumber             String?
  nationalAddress       String?
  customerType          String    @default("RETAIL")
  businessCustomerType  String?
  assignedPriceLevel    String    @default("PRICE_3")
  priceVisibility       String    @default("ALL")
  isApproved            Boolean   @default(false)
  searchPointsTotal     Int       @default(0)
  searchPointsRemaining Int       @default(0)
  suspendedUntil        DateTime?
  internalNotes         String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  branches              Branch[]
  documents             Document[]
}

model Branch {
  id            String   @id @default(uuid())
  profileId     String
  profile       BusinessProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  name          String
  city          String
  phone         String?
  address       String?
  managerName   String?
  managerPhone  String?
  isMainBranch  Boolean  @default(false)
  createdAt     DateTime @default(now())
}

model Document {
  id          String   @id @default(uuid())
  profileId   String
  profile     BusinessProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  type        String
  fileName    String
  fileUrl     String
  status      String   @default("PENDING")
  createdAt   DateTime @default(now())
}

model ActivityLog {
  id          String   @id @default(uuid())
  userId      String?
  user        User?    @relation(fields: [userId], references: [id])
  userName    String?
  role        String?
  eventType   String
  description String
  page        String?
  metadata    String?
  createdAt   DateTime @default(now())
}

// ============ Organization Models ============

model Organization {
  id                   String   @id @default(uuid())
  type                 String   @default("TRADER")
  name                 String
  ownerUserId          String
  maxEmployees         Int      @default(5)
  allowCustomPermissions Boolean @default(false)
  status               String   @default("ACTIVE")
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  users                OrganizationUser[]
  invitations          TeamInvitation[]
  activityLogs         OrgActivityLog[]
}

model OrganizationUser {
  id              String   @id @default(uuid())
  organizationId  String
  organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  role            String   @default("STAFF")
  permissions     String?
  jobTitle        String?
  department      String?
  status          String   @default("ACTIVE")
  invitedBy       String?
  joinedAt        DateTime @default(now())
  lastActiveAt    DateTime?
}

model TeamInvitation {
  id              String   @id @default(uuid())
  organizationId  String
  organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  email           String
  phone           String?
  role            String   @default("STAFF")
  inviteCode      String   @unique
  status          String   @default("PENDING")
  expiresAt       DateTime
  createdBy       String
  acceptedAt      DateTime?
  createdAt       DateTime @default(now())
}

model OrgActivityLog {
  id              String   @id @default(uuid())
  organizationId  String
  organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  userId          String
  userName        String?
  action          String
  description     String
  metadata        String?
  createdAt       DateTime @default(now())
}

// ============ Product Models ============

model Product {
  id              String   @id @default(uuid())
  partNumber      String   @unique
  name            String
  nameEn          String?
  nameAr          String?
  nameZh          String?
  brand           String?
  category        String?
  description     String?
  imageUrl        String?
  imageGallery    String[]
  priceRetail     Float    @default(0)
  priceWholesale  Float    @default(0)
  priceVip        Float    @default(0)
  stock           Int      @default(0)
  isActive        Boolean  @default(true)
  qualityCodeId   String?
  qualityCode     QualityCode? @relation(fields: [qualityCodeId], references: [id])
  brandCodeId     String?
  brandCode       BrandCode? @relation(fields: [brandCodeId], references: [id])
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  orderItems      OrderItem[]
  quoteItems      QuoteItem[]
}

// ============ Order Models ============

model Order {
  id              String   @id @default(uuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id])
  businessId      String?
  branchId        String?
  status          String   @default("PENDING")
  internalStatus  String   @default("NEW")
  internalNotes   String?
  totalAmount     Float    @default(0)
  currency        String   @default("SAR")
  cancelledBy     String?
  cancelledAt     DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  items           OrderItem[]
  statusHistory   OrderStatusHistory[]
}

model OrderItem {
  id          String   @id @default(uuid())
  orderId     String
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId   String?
  product     Product? @relation(fields: [productId], references: [id])
  partNumber  String
  name        String
  quantity    Int
  unitPrice   Float
  totalPrice  Float
  qualityCode String?
  createdAt   DateTime @default(now())
}

model OrderStatusHistory {
  id        String   @id @default(uuid())
  orderId   String
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  status    String
  changedBy String
  note      String?
  changedAt DateTime @default(now())
}

model QuoteRequest {
  id           String   @id @default(uuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id])
  userName     String?
  companyName  String?
  priceType    String?
  status       String   @default("NEW")
  resultReady  Boolean  @default(false)
  processedAt  DateTime?
  qualityCode  String?
  createdAt    DateTime @default(now())

  items        QuoteItem[]
}

model QuoteItem {
  id           String   @id @default(uuid())
  quoteId      String
  quote        QuoteRequest @relation(fields: [quoteId], references: [id], onDelete: Cascade)
  productId    String?
  product      Product? @relation(fields: [productId], references: [id])
  partNumber   String
  partName     String?
  requestedQty Int
  matchedPrice Float?
  notes        String?
  status       String   @default("PENDING")
  qualityCode  String?
}

// ============ Installment Models ============

model InstallmentRequest {
  id                      String   @id @default(uuid())
  customerId              String
  customer                User     @relation(fields: [customerId], references: [id])
  customerName            String?
  totalRequestedValue     Float
  paymentFrequency        String   @default("MONTHLY")
  requestedDurationMonths Int
  status                  String   @default("PENDING_SINICAR_REVIEW")
  sinicarDecision         String   @default("PENDING")
  adminNotes              String?
  allowedForSuppliers     Boolean  @default(false)
  forwardedToSupplierIds  String?
  reviewedBy              String?
  reviewedAt              DateTime?
  acceptedOfferId         String?
  closedAt                DateTime?
  closedReason            String?
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  items                   InstallmentItem[]
  offers                  InstallmentOffer[]
}

model InstallmentItem {
  id             String   @id @default(uuid())
  requestId      String
  request        InstallmentRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  partNumber     String
  partName       String?
  quantity       Int
  estimatedPrice Float
}

model InstallmentOffer {
  id                 String   @id @default(uuid())
  requestId          String
  request            InstallmentRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  sourceType         String   @default("SINICAR")
  supplierId         String?
  supplierName       String?
  type               String   @default("FULL")
  itemsApproved      String?
  totalApprovedValue Float
  schedule           String?
  notes              String?
  status             String   @default("WAITING_FOR_CUSTOMER")
  createdBy          String?
  createdAt          DateTime @default(now())
}

model InstallmentSettings {
  id                   String  @id @default(uuid())
  key                  String  @unique @default("global")
  enableInstallments   Boolean @default(true)
  allowSupplierOffers  Boolean @default(true)
  minInstallmentValue  Float   @default(1000)
  maxInstallmentValue  Float   @default(100000)
  minDurationMonths    Int     @default(3)
  maxDurationMonths    Int     @default(24)
  defaultCommission    Float   @default(5)
}

// ============ Supplier Models (Extended) ============

model SupplierGroup {
  id                   String   @id @default(uuid())
  name                 String
  nameAr               String?
  nameEn               String?
  description          String?
  defaultMarginPercent Float    @default(15)
  isActive             Boolean  @default(true)
  sortOrder            Int      @default(0)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  suppliers            SupplierProfile[]
}

model SupplierProfile {
  id                   String       @id @default(uuid())
  customerId           String
  companyName          String
  contactName          String?
  contactPhone         String?
  contactEmail         String?
  categories           String?
  regions              String?
  rating               Float        @default(0)
  totalRevenue         Float        @default(0)
  status               String       @default("PENDING")
  
  supplierType         SupplierType @default(LOCAL)
  groupId              String?
  group                SupplierGroup? @relation(fields: [groupId], references: [id])
  customMarginPercent  Float?
  
  country              String?
  city                 String?
  vatNumber            String?
  crNumber             String?
  preferredCurrency    String       @default("SAR")
  allowedCurrencies    String[]
  shippingOriginCity   String?
  languageHint         String?
  
  createdAt            DateTime     @default(now())
  updatedAt            DateTime     @updatedAt

  catalogItems         SupplierCatalogItem[]
  excelUploads         SupplierExcelUpload[]
}

model SupplierCatalogItem {
  id              String   @id @default(uuid())
  supplierId      String
  supplier        SupplierProfile @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  partNumber      String
  partName        String?
  originalName    String?
  translatedNameAr String?
  translatedNameEn String?
  brand           String?
  price           Float
  currency        String   @default("SAR")
  qualityCodeId   String?
  qualityCode     QualityCode? @relation(fields: [qualityCodeId], references: [id])
  brandCodeId     String?
  brandCode       BrandCode? @relation(fields: [brandCodeId], references: [id])
  stock           Int      @default(0)
  leadTimeDays    Int      @default(7)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model SupplierExcelUpload {
  id              String       @id @default(uuid())
  supplierId      String
  supplier        SupplierProfile @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  templateId      String?
  template        ExcelImportTemplate? @relation(fields: [templateId], references: [id])
  originalFileName String
  originalFileUrl String
  status          UploadStatus @default(PENDING_REVIEW)
  aiSummary       String?
  adminComment    String?
  rowsTotal       Int          @default(0)
  rowsValid       Int          @default(0)
  rowsInvalid     Int          @default(0)
  unknownCodes    String[]
  reviewedBy      String?
  reviewedAt      DateTime?
  createdAt       DateTime     @default(now())
}

model SupplierMarketplaceSettings {
  id                       String  @id @default(uuid())
  key                      String  @unique @default("global")
  enableMarketplace        Boolean @default(true)
  hideRealSupplierFromCustomer Boolean @default(false)
  markupPercentage         Float   @default(0)
}

// ============ Currency & Pricing Models ============

model Currency {
  id            String   @id @default(uuid())
  code          String   @unique
  name          String
  nameAr        String?
  nameEn        String?
  symbol        String
  isBase        Boolean  @default(false)
  isActive      Boolean  @default(true)
  sortOrder     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  exchangeRates ExchangeRate[]
}

model ExchangeRate {
  id            String   @id @default(uuid())
  currencyId    String
  currency      Currency @relation(fields: [currencyId], references: [id], onDelete: Cascade)
  rateToBase    Float
  syncPercent   Float    @default(100)
  effectiveFrom DateTime @default(now())
  effectiveTo   DateTime?
  isActive      Boolean  @default(true)
  updatedBy     String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([currencyId, effectiveFrom])
}

// ============ Quality & Brand Codes ============

model QualityCode {
  id                  String   @id @default(uuid())
  code                String   @unique
  label               String
  labelAr             String?
  labelEn             String?
  labelHi             String?
  labelZh             String?
  description         String?
  defaultMarginAdjust Float    @default(0)
  sortOrder           Int      @default(0)
  isActive            Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  products            Product[]
  catalogItems        SupplierCatalogItem[]
}

model BrandCode {
  id          String   @id @default(uuid())
  code        String   @unique
  name        String
  nameAr      String?
  nameEn      String?
  logoUrl     String?
  country     String?
  description String?
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  products     Product[]
  catalogItems SupplierCatalogItem[]
}

// ============ Excel Import Templates ============

model ExcelImportTemplate {
  id                  String   @id @default(uuid())
  name                String
  nameAr              String?
  nameEn              String?
  description         String?
  templateType        String   @default("SUPPLIER_PRODUCT")
  languageHint        String?
  instructionsText    String?
  instructionsTextAr  String?
  templateFileUrl     String?
  isActive            Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  columns             TemplateColumn[]
  uploads             SupplierExcelUpload[]
}

model TemplateColumn {
  id           String   @id @default(uuid())
  templateId   String
  template     ExcelImportTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  columnKey    String
  columnName   String
  columnNameAr String?
  columnIndex  Int
  isRequired   Boolean  @default(false)
  dataType     String   @default("TEXT")
  defaultValue String?
  validation   String?
  sortOrder    Int      @default(0)
}

// ============ Shipping Configuration ============

model ShippingMethod {
  id            String   @id @default(uuid())
  code          String   @unique
  name          String
  nameAr        String?
  nameEn        String?
  description   String?
  baseRate      Float    @default(0)
  perKgRate     Float    @default(0)
  minCharge     Float    @default(0)
  deliveryDays  Int      @default(7)
  isActive      Boolean  @default(true)
  sortOrder     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model ShippingZone {
  id            String   @id @default(uuid())
  code          String   @unique
  name          String
  nameAr        String?
  countries     String[]
  extraRatePerKg Float   @default(0)
  isActive      Boolean  @default(true)
  sortOrder     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// ============ Permission System ============

model Role {
  id          String   @id @default(uuid())
  code        String   @unique
  name        String
  nameAr      String?
  nameEn      String?
  description String?
  isSystem    Boolean  @default(false)
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  permissions     RolePermission[]
  users           UserRoleAssignment[]
  defaultGroups   RolePermissionGroup[]
}

model Permission {
  id          String   @id @default(uuid())
  code        String   @unique
  name        String
  nameAr      String?
  nameEn      String?
  module      String
  category    String   @default("GENERAL")
  description String?
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  roles           RolePermission[]
  groupPermissions PermissionGroupPermission[]
  userOverrides   UserPermissionOverride[]
  supplierEmployeePermissions SupplierEmployeePermission[]
}

model RolePermission {
  id           String   @id @default(uuid())
  roleId       String
  role         Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permissionId String
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  effect       String   @default("ALLOW")
  canCreate    Boolean  @default(false)
  canRead      Boolean  @default(true)
  canUpdate    Boolean  @default(false)
  canDelete    Boolean  @default(false)
  createdAt    DateTime @default(now())

  @@unique([roleId, permissionId])
}

model UserRoleAssignment {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  roleId    String
  role      Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  isActive  Boolean  @default(true)
  assignedBy String?
  assignedAt DateTime @default(now())

  @@unique([userId, roleId])
}

model PermissionGroup {
  id          String   @id @default(uuid())
  code        String   @unique
  name        String
  nameAr      String?
  nameEn      String?
  description String?
  isSystemDefault Boolean @default(false)
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  permissions PermissionGroupPermission[]
  roles       RolePermissionGroup[]
  users       UserPermissionGroup[]
}

model PermissionGroupPermission {
  id           String   @id @default(uuid())
  groupId      String
  group        PermissionGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  permissionId String
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  effect       String   @default("ALLOW")
  createdAt    DateTime @default(now())

  @@unique([groupId, permissionId])
}

model RolePermissionGroup {
  id        String   @id @default(uuid())
  roleId    String
  role      Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  groupId   String
  group     PermissionGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([roleId, groupId])
}

model UserPermissionGroup {
  id        String   @id @default(uuid())
  userId    String
  groupId   String
  group     PermissionGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  assignedBy String?
  createdAt DateTime @default(now())

  @@unique([userId, groupId])
}

model UserPermissionOverride {
  id           String   @id @default(uuid())
  userId       String
  permissionId String
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  effect       String   @default("ALLOW")
  reason       String?
  assignedBy   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([userId, permissionId])
}

model CustomerFeatureVisibility {
  id                     String   @id @default(uuid())
  customerId             String
  featureCode            String
  visibility             String   @default("SHOW")
  conditionProfilePercent Int?
  reason                 String?
  assignedBy             String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  @@unique([customerId, featureCode])
}

model SupplierEmployee {
  id               String   @id @default(uuid())
  supplierId       String
  userId           String
  roleWithinSupplier String @default("SUPPLIER_VIEWER")
  jobTitle         String?
  department       String?
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  permissions      SupplierEmployeePermission[]

  @@unique([supplierId, userId])
}

model SupplierEmployeePermission {
  id                 String   @id @default(uuid())
  supplierEmployeeId String
  supplierEmployee   SupplierEmployee @relation(fields: [supplierEmployeeId], references: [id], onDelete: Cascade)
  permissionId       String
  permission         Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  effect             String   @default("ALLOW")
  createdAt          DateTime @default(now())

  @@unique([supplierEmployeeId, permissionId])
}

model ModuleAccess {
  id           String   @id @default(uuid())
  moduleKey    String   @unique
  moduleName   String
  moduleNameAr String?
  description  String?
  isEnabled    Boolean  @default(true)
  requiredRole String?
  sortOrder    Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

// ============ Global Settings ============

model GlobalSetting {
  id          String   @id @default(uuid())
  key         String   @unique
  value       String
  valueType   String   @default("STRING")
  category    String   @default("GENERAL")
  label       String?
  labelAr     String?
  description String?
  isEditable  Boolean  @default(true)
  isVisible   Boolean  @default(true)
  sortOrder   Int      @default(0)
  updatedBy   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model FeatureFlag {
  id          String   @id @default(uuid())
  key         String   @unique
  name        String
  nameAr      String?
  description String?
  isEnabled   Boolean  @default(false)
  enabledFor  String[]
  metadata    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ============ Advertising Models ============

model Advertiser {
  id            String   @id @default(uuid())
  name          String
  contactName   String?
  contactEmail  String?
  contactPhone  String?
  balance       Float    @default(0)
  status        String   @default("ACTIVE")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  campaigns     AdCampaign[]
}

model AdSlot {
  id            String   @id @default(uuid())
  name          String
  location      String
  width         Int
  height        Int
  pricePerDay   Float
  pricePerWeek  Float
  pricePerMonth Float
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  campaigns     AdCampaign[]
}

model AdCampaign {
  id            String   @id @default(uuid())
  advertiserId  String
  advertiser    Advertiser @relation(fields: [advertiserId], references: [id])
  slotId        String
  slot          AdSlot   @relation(fields: [slotId], references: [id])
  title         String
  imageUrl      String?
  targetUrl     String?
  budget        Float    @default(0)
  spent         Float    @default(0)
  impressions   Int      @default(0)
  clicks        Int      @default(0)
  startDate     DateTime
  endDate       DateTime
  status        String   @default("PENDING")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// ============ Tools Models ============

model ToolConfig {
  id                   String   @id @default(uuid())
  toolKey              String   @unique
  displayName          String
  displayNameAr        String?
  description          String?
  descriptionAr        String?
  isEnabled            Boolean  @default(true)
  dailyLimit           Int?
  monthlyLimit         Int?
  requiredPriceLevel   String?
  allowedCustomerTypes String?
  requiredPermission   String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

model CustomerToolsOverride {
  id          String   @id @default(uuid())
  customerId  String   @unique
  overrides   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ToolUsageRecord {
  id          String   @id @default(uuid())
  customerId  String
  toolKey     String
  metadata    String?
  usageDate   DateTime @default(now())
}

model PriceComparisonSession {
  id          String   @id @default(uuid())
  customerId  String
  partNumbers String
  supplierIds String?
  results     String?
  createdAt   DateTime @default(now())
}

model VinExtractionRecord {
  id            String   @id @default(uuid())
  customerId    String
  vinNumber     String
  extractedData String
  createdAt     DateTime @default(now())
}

model SupplierPriceRecord {
  id           String   @id @default(uuid())
  customerId   String
  fileName     String?
  supplierName String?
  data         String
  createdAt    DateTime @default(now())
}

// ============ Marketer Models ============

model Marketer {
  id              String   @id @default(uuid())
  userId          String?
  name            String
  email           String
  phone           String
  paymentMethod   String?
  bankDetails     String?
  commissionRate  Float    @default(5)
  referralCode    String   @unique
  referralUrl     String?
  referralCount   Int      @default(0)
  totalEarnings   Float    @default(0)
  pendingPayouts  Float    @default(0)
  paidAmount      Float    @default(0)
  status          String   @default("PENDING")
  approvedAt      DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  referrals       CustomerReferral[]
  commissions     MarketerCommission[]
}

model CustomerReferral {
  id           String   @id @default(uuid())
  marketerId   String
  marketer     Marketer @relation(fields: [marketerId], references: [id], onDelete: Cascade)
  customerId   String
  customerName String?
  status       String   @default("PENDING")
  convertedAt  DateTime?
  createdAt    DateTime @default(now())
}

model MarketerCommission {
  id               String   @id @default(uuid())
  marketerId       String
  marketer         Marketer @relation(fields: [marketerId], references: [id], onDelete: Cascade)
  orderId          String
  customerId       String
  customerName     String?
  orderAmount      Float
  commissionRate   Float
  commissionAmount Float
  status           String   @default("PENDING")
  approvedAt       DateTime?
  paidAt           DateTime?
  createdAt        DateTime @default(now())
}

model MarketerSettings {
  id                    String  @id @default(uuid())
  key                   String  @unique @default("global")
  enableMarketing       Boolean @default(true)
  defaultCommissionRate Float   @default(5)
  minPayoutAmount       Float   @default(100)
  payoutFrequency       String  @default("MONTHLY")
}

// ============ Account Opening Request ============

model AccountOpeningRequest {
  id            String   @id @default(uuid())
  companyName   String
  ownerName     String
  phone         String
  email         String?
  region        String?
  city          String?
  crNumber      String?
  businessType  String?
  status        String   @default("PENDING")
  reviewedBy    String?
  reviewedAt    DateTime?
  adminNotes    String?
  createdAt     DateTime @default(now())
}
